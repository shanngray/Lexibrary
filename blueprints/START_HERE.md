# Lexibrarian — Start Here

## Project Topology

```
src/lexibrarian/
├── cli.py                  ← Typer CLI entry point (lexi command)
├── exceptions.py           ← LexibraryNotFoundError
├── artifacts/              ← Pydantic 2 models for all output artifact types
├── baml_client/            ← AUTO-GENERATED by BAML — do not edit
├── config/                 ← Config schema (Pydantic 2) + loader + defaults
├── crawler/                ← Bottom-up crawl orchestration + change detection
├── daemon/                 ← Watchdog file watcher + debouncer + periodic sweep
├── ignore/                 ← pathspec-based ignore pattern matching
├── init/                   ← lexi init scaffolding (.lexibrary/ skeleton)
├── llm/                    ← BAML client wrapper + rate limiter + factory
├── tokenizer/              ← Pluggable token counting backends
└── utils/                  ← Hashing, language detection, logging, paths, root
```

## Package Map

| Package | Role |
| --- | --- |
| `artifacts` | Pydantic 2 models: `DesignFile`, `AIndexFile`, `ConceptFile`, `GuardrailThread` |
| `config` | `LexibraryConfig` schema, two-tier YAML loader, default config template |
| `crawler` | `full_crawl()` orchestrator; discovery, file reading, change detection |
| `daemon` | `DaemonService` — watchdog + debounce + periodic sweep |
| `ignore` | `IgnoreMatcher` combining `.gitignore` + config patterns via pathspec |
| `init` | `create_lexibrary_skeleton()` — creates `.lexibrary/` on `lexi init` |
| `llm` | `LLMService` wrapping BAML client; `RateLimiter`; `create_llm_service()` factory |
| `tokenizer` | `TokenCounter` protocol; tiktoken / anthropic / approximate backends |
| `utils` | `hash_file`, `detect_language`, `setup_logging`, `find_project_root`, path helpers |

## Navigation by Intent

| Task | Read first |
| --- | --- |
| Add / modify a CLI command | `blueprints/src/lexibrarian/cli.md` |
| Change config keys or defaults | `blueprints/src/lexibrarian/config/` |
| Modify crawl logic | `blueprints/src/lexibrarian/crawler/engine.md` |
| Change ignore patterns | `blueprints/src/lexibrarian/ignore/` |
| Add / modify LLM prompts | `baml_src/` (source-of-truth for prompts) |
| Change artifact data models | `blueprints/src/lexibrarian/artifacts/` |
| Modify daemon behavior | `blueprints/src/lexibrarian/daemon/` |
| Add a tokenizer backend | `blueprints/src/lexibrarian/tokenizer/` |
| Change `lexi init` scaffolding | `blueprints/src/lexibrarian/init/scaffolder.md` |
| Change path utilities | `blueprints/src/lexibrarian/utils/paths.md` |
| Raise / handle project-not-found | `blueprints/src/lexibrarian/exceptions.md` |

## Key Constraints

- `from __future__ import annotations` in **every** module
- pathspec pattern name is `"gitignore"` — NOT `"gitwildmatch"`
- Config: YAML via PyYAML, validated with Pydantic 2
- Output: `rich.console.Console` — no bare `print()`
- `baml_client/` is auto-generated — never edit it directly
- Schema (`config/schema.py`) is incomplete: `TokenizerConfig`, `CrawlConfig`, `OutputConfig` are **not yet defined** but are referenced in engine and daemon

## Navigation Protocol

Before editing a file, read its design file in `blueprints/src/`. Keep design files updated when you change source files — the source is truth, the design file is the explanation.
